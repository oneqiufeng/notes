# 基于深度强化学习的城市社区空间规划

# [[AI improves the design of urban communities]]

有效的城市社区空间规划对城市的可持续发展起着至关重要的作用。尽管地理信息系统和计算机辅助设计带来了便利，但土地使用和道路布局的确定仍然在很大程度上依赖于人类专家。在此，我们提出了一种人工智能城市规划模型，用于生成城市社区的空间规划。为了克服多样化和不规则的城市地理的困难，我们构建了一个图来描述任意形式的城市拓扑结构，并将城市规划表述为图上的一个顺序决策问题。为了应对广阔解法空间的挑战，我们开发了基于图神经网络的强化学习模型。在合成社区和真实世界社区进行的实验表明，我们的计算模型在客观指标上优于人类专家设计的规划，而且它能生成应对不同情况和需求的空间规划。我们还提出了一种城市规划的人类-人工智能协作工作流程，在这种流程中，人类设计师可以从我们的模型中获益匪浅，以更少的时间生成更高效的空间规划，从而提高工作效率。我们的方法展示了计算城市规划的巨大潜力，并为更多利用计算方法解决城市科学中具有挑战性的现实问题的探索铺平了道路。

# 学习

在一篇同期发的新闻与观点文章中，MIT 可感知城市实验室（MIT Senseable City Lab）的研究科学家 Paolo Santi 写道：“**Yu Zheng 等人处理了关键的概念性和计算性挑战，同时还成功展示了将 AI 与人类工作流程融合于空间布局规划领域的可行性，为未来提供了丰富的研究方向**。

**城市规划亟待转变，“15分钟城市”概念广受欢迎**

城市已经成为创新、创意和机遇的中心，它吸引着来自各行各业的人们，他们在这里寻求娱乐、教育、医疗和就业的机会。**有效空间规划对于城市的经济活动和可持续发展至关重要。**

现代城市规划往往以车辆为导向，偏向于集中式功能和依赖汽车的交通方式，这样的方式不仅会造成交通拥堵，还会加剧全球气候变暖。同时，新冠疫情也暴露出城市在封锁期间的脆弱性。**因此，城市规划亟待转变，需要加快从以车辆为导向转向以人为导向**。

值得注意的是，**“15 分钟城市”概念在规划新的城市社区和翻新现有社区方面越来越受欢迎**，居民可以在 15 分钟内步行或骑行到基本服务设施，这也体现了人们对于城市社区内高空间效率布局的期待。

然而，人类已经投入了几十年的努力来开发计算模型和支持工具，以使城市规划自动化。现在，尽管人类城市规划师使用地理信息系统工具的生产力比几十年前高了几个数量级，**但繁琐的布局任务仍然需要手动完成**。

  **相比于人类专家，AI 代理能够生成更高效的规划方案**

为了应对上述挑战，清华大学的研究团队提出了基于深度强化学习的城市规划模型，该模型能够生成城市社区的土地利用和道路布局。

然而，与芯片设计和围棋等具有规则网格条件的任务相比，城市社区存在不同形式的几何形状，更具多样性和不规则性。

**为解决该问题，研究团队提出了一个城市连续性图**，用于描述城市几何的拓扑结构，其中城市地理元素作为节点，空间连续性作为边。图的构建允许捕捉任何形式社区的基本空间关系。因此，他们将空间规划制定为图上的顺序决策问题，并在拓扑层面上进行规划，而不是在几何层面上。

另外，空间规划的另一个主要挑战是巨大的解决方案空间和更大的伴随动作空间。一个中等规模社区的动作空间可能很容易超过 4000的一百次方（每个步骤有 4000 种可能动作，共 100 个步骤用于社区空间规划），这使得穷举搜索不可行。

**为了减小动作空间，研究人员训练了一个 AI 代理，该代理由一个价值网络和两个策略网络组成**，通过在巨大的动作空间中进行高效的探索和利用来寻找良好的规划策略。具体而言，价值网络基于“15 分钟城市”概念的实现情况来预测空间规划的质量，另外两个策略网络用于 AI 代理选择土地利用和道路的位置。通过从策略网络中采样动作并使用价值网络估计奖励，动作空间得到了大幅缩小。

**为了获得城市地理元素的有效表示，研究人员又进一步开发了基于图神经网络（GNN）的状态编码器**，它利用城市连续性图上的消息传递和邻居聚合，捕捉土地、道路段和交汇点之间的空间关系。这个 GNN 状态编码器在价值网络和策略网络之间共享，从而促进奖励预测和位置选择。最终，相比于人类专家，AI 代理能够生成更高效的规划方案。

广泛的实验结果表明，**在相同的初始条件和规划约束下，该方法明显优于最先进的算法和人类专家**，可以将空间效率的客观指标提高 48.6% 以上。特别是在使用现有的真实社区作为初始条件时，该模型可以生成土地利用改造计划，将居民对各种设施的可访问性显著提高 18.5% 以上。

考虑到城市规划方法的成熟性和复杂性，基于所呈现的 DRL 模型，研究人员提出了一个 AI 与人类设计师协作的工作流程，其中人类设计师专注于概念原型设计，并利用该模型完成繁重和耗时的规划工作。

结果证明，**人类设计师可以从 AI 与人类协作的工作流程中受益**，该工作流程在客观规划指标和由 100 名专业人类设计师组成的主观盲测试中均优于完全由人类劳动完成的工作流程，并在时间效率上提高 3000 倍。

此外，该模型还可以从简单的场景中学习通用的规划技能，并将其应用于设计不同风格的大规模复杂规划任务中，例如绿色社区和服务社区。

**机器学习促进可持续城市发展与多方参与**

然而，在本次实验中，虽然生成的空间规划数量超过 100 万个，但与类似的 DRL 任务（如围棋和芯片设计）中利用的数据集相比，仍然不够大。另外，本次研究方法扩展到城市级别需要从分布式集群收集大量的训练样本，以及在多台服务器上使用多个 GPU 训练更大的神经网络。

值得注意的是，分解的三个子空间（什么要规划、在哪里规划和如何规划）可以由代理共同优化，但这需要更多的训练样本。此外，什么要规划的部分可以扩展到包括与城市可持续性相关的其他重要元素，如公共交通路线和车站。另外，该框架还忽视了空间规划的一些主观评估指标，如美学和艺术评分。

当前框架主要受静态指标的引导，虽然可以生成具有高空间效率的社区规划，但规划整个城市是一项更加复杂的任务，需要考虑经济增长和居民健康在内的多样化目标。通过一些静态指标来评估城市级别规划的影响几乎是不可能的。

在大多数实验中，研究人员忽略了数百条城市规划的规则，没有考虑到实际城市规划中的土地所有权、公共通道、城市隔离和翻新等关键问题。但是，通过必要和合理的调整，该方法可以很好地处理这些实际规划中的规则和政治问题。

**尽管研究还存在不足之处，但我们不能否认它的意义**。

机器学习作为支持性工具可以增加人类规划师的生产力，也有可能创造出更加可持续发展的城市生活。另外，除了帮助规划者加速空间布局过程外，还可以为其他参与者带来更广泛的好处。通过引入定制选项到模型中，可以构建公共平台，促进居民和开发商参与规划过程。

**正如研究论文所提到的那样，城市规划绝不是一个简单的选择土地利用和道路位置的游戏，而是多方利益相关者之间复杂的互动**。本次研究提出的框架展示了所有参与者更高程度参与的可能性，是迈向更加透明和包容城市的一小步。

https://www.nature.com/articles/s43588-023-00503-5

https://www.nature.com/articles/s43588-023-00515-1

# 复现

https://www.nature.com/articles/s43588-023-00503-5
## “Spatial planning of urban communities via deep reinforcement learning” (Yu Zheng 等, 2023, p. 748) 基于深度强化学习的城市社区空间规划

## Data availability

The geographic data of communities used in this work is collected from OpenStreetMap ([https://www.openstreetmap.org](https://www.openstreetmap.org/)) using Python 3.8.0 with packages osmnx>=1.1.2 and geopandas>=0.11.1. We provide the data for the three adopted communities in our experiments. The data supporting the results of this study is available on Zenodo ([https://doi.org/10.5281/zenodo.8175420](https://doi.org/10.5281/zenodo.8175420))[50](https://www.nature.com/articles/s43588-023-00503-5#ref-CR50 "Zheng, Y. tsinghua-fib-lab/drl-urban-planning: Release v0.1 Zenodo 
https://doi.org/10.5281/zenodo.8175420
(2023).") and GitHub ([https://github.com/tsinghua-fib-lab/DRL-urban-planning](https://github.com/tsinghua-fib-lab/DRL-urban-planning)). [Source data](https://www.nature.com/articles/s43588-023-00503-5#Sec30) are provided with this paper.

## Code availability

The code used in this research can be found at Zenodo ([https://doi.org/10.5281/zenodo.8175420](https://doi.org/10.5281/zenodo.8175420))[50](https://www.nature.com/articles/s43588-023-00503-5#ref-CR50 "Zheng, Y. tsinghua-fib-lab/drl-urban-planning: Release v0.1 Zenodo 
https://doi.org/10.5281/zenodo.8175420
(2023).") and Github ([https://github.com/tsinghua-fib-lab/DRL-urban-planning](https://github.com/tsinghua-fib-lab/DRL-urban-planning)).

